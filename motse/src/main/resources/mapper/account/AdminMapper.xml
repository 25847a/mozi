<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fadl.account.dao.AdminMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.fadl.account.entity.Admin">
        <id column="id" property="id" />
        <result column="account" property="account" />
        <result column="passWord" property="passWord" />
        <result column="name" property="name" />
        <result column="age" property="age" />
        <result column="gender" property="gender" />
        <result column="position" property="position" />
        <result column="phone" property="phone" />
        <result column="address" property="address" />
        <result column="avatar" property="avatar" />
        <result column="wechat" property="wechat" />
        <result column="qq" property="qq" />
        <result column="positionId" property="positionId" />
        <result column="role" property="role" />
        <result column="createDate" property="createDate" />
        <result column="updateDate" property="updateDate" />
        <result column="creater" property="creater" />
        <result column="updater" property="updater" />
        <result column="remarks" property="remarks" />
        <result column="isLoginCount" property="isLoginCount" />
        <result column="isDisable" property="isDisable" />
        <result column="loginErrorCount" property="loginErrorCount" />
        <result column="firstDate" property="firstDate" />
        <result column="lastDate" property="lastDate" />
        <result column="lockDate" property="lockDate" />
        
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        id, account, passWord,isLoginCount, name, age, gender, position, phone, address, avatar, wechat, qq,positionId,isDisable,loginErrorCount, role, createDate, updateDate, creater, updater, remarks,firstDate,lastDate,lockDate
    </sql>
	<!-- 根据用户名查询用户信息-->
	<select id="queryAdminInfo" parameterType="java.lang.String" resultMap="BaseResultMap">
		SELECT * FROM admin WHERE account=#{account}
	</select>
	
	<!-- 查询代理商列表 -->
	<select id="queryAdminList" resultType="com.fadl.common.DataRow">
		SELECT tp.id,tp.name,tp.age,tp.gender,tp.account,tp.address,DATE_FORMAT(tp.createDate,'%Y-%m-%d %H:%i:%s') as createDate,CASE WHEN tt.count is null THEN 0 else tt.count end AS count FROM admin tp
		LEFT JOIN (SELECT agentid,COUNT(*) AS count FROM equipment GROUP BY agentid) tt
		ON tp.id=tt.agentid
	</select>
	<!-- 查询用户的角色 -->
	<select id="queryAdminRoleInfo" resultType="com.fadl.common.DataRow" parameterType="java.lang.Long">
		SELECT td.name FROM admin tp
		LEFT JOIN position tt
		ON tp.positionId=tt.id
		LEFT JOIN role td
		ON tt.roleId=td.id
		WHERE tp.id=#{id}
	</select>
	<!-- 查询用户管理列表 -->
	<select id="queryAdminInfoList" resultType="com.fadl.common.DataRow" parameterType="java.util.HashMap">
		SELECT tp.id,td.name AS role,tt.position,tp.name,tp.account,tp.isDisable,tp.isLoginCount,tp.loginErrorCount,DATE_FORMAT(tp.lockDate,'%Y-%m-%d %H:%i:%s') as lockDate
		,DATE_FORMAT(tp.lastDate,'%Y-%m-%d %H:%i:%s') as lastDate from admin tp
		LEFT JOIN position tt
		ON tp.positionId=tt.id
		LEFT JOIN role td
		ON tt.roleId=td.id
		where 1=1
		<if test="account!=null and account!=''">
		AND tp.account=#{account}
		</if>
		<if test="name!=null and name!=''">
		AND tp.name=#{name}
		</if>
	</select>
</mapper>
